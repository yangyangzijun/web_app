<!DOCTYPE html>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js"> </script>
<script>

</script>
<html>
    <head>
        <title> 购物车 </title>
        <meta charset="utf-8"/>

        <style type="text/css">

            #cart
{
    border: 1px solid #f1f1f1;
    border-top:2px solid #aaa;
    width:1000px;
    background-color: #fcfffa;
    margin:0px auto;
    margin-top:50px;
    margin-left: 100px;
    border-collapse: collapse;
}
#cart td,#cart th{
    min-height:40px;
    line-height:40px;
    border-top:1px solid #f1f1f1;
    border-bottom:1px solid #f1f1f1;
    padding:5px;
    vertical-align: top;
    text-align: left;
}
#cart thead input{
    vertical-align: middle;
}
#cart tbody input[type='checkbox']{
    float:left;
    margin-right: 10px;
}
#cart tbody div{
    border:1px solid #f1f1f1;
    padding:5px;
    float:left;
    width:90px;
    height:80px;
    text-align: center;
}
#cart tbody img {
    width:100%;
    height:100%;
}
#cart a
{
    text-decoration:none;
    color:#666;
}
#cart a:hover
{
    color:#E4393C;
}
#cart tbody td span{
    font-weight: bold;
}


#cart tbody td button{
    border:1px solid #CACBCB;
    height:20px;
    width:20px;
    padding:0;
    background-color: #fff;
    box-sizing:content-box;
}
#cart_footer{
    position: fixed;
    width:100%;
    height:80px;
    bottom:0px;
    left:0px;
    background-color: #fff;
    box-shadow: 0 -1px 8px rgba(0,1,1,.08);
    z-inxe:10000;
}
#cart_footer>div{
    text-align: right;
    margin:10px auto;
    width:800px;
    height:52px;
    line-height: 52px;
}
#cart_footer>div>span{
    font-size: 16px;
    color: #e4393c;
    font-weight: 700;
}
#cart_footer>div>button{
    display: inline-block;
    width: 96px;
    height: 52px;
    overflow: hidden;
    background-color:#E54346;
    border:0;
    line-height: 52px;
    color: #fff;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    font-family: "microsoft yahei";
    margin-left:20px;
}

body{
    overflow-x: hidden;
}

/*transition过渡：某种样式属性（数值）在一段时间内缓慢变化*/
#cart tbody img{
    transition: transform 0.5s linear;
}

/*transform：转换（变形：放大、移动、旋转、skew）*/
#cart tbody img:hover{
    transform:scale(1.1);
    /*transform:rotate(45deg);*/
}

#cart:hover::before{
    transition: left 2s;
    left: 1360px;
}
#cart:before{
    /*border:1px solid red;*/
    content: "";
    position: absolute;
    width: 80px;
    height: 400px;
    top: 180px;
    left: -150px;
    overflow: hidden;
    background-image: linear-gradient(to right,rgba(255,255,255,0.2) 0,rgba(255,255,255,0.8) 50%,rgba(255,255,255,0.2) 100%);
    transform: skewX(-15deg);
}

#cart
{
    border: 1px solid #f1f1f1;
    border-top:2px solid #aaa;
    width:800px;
    background-color: #fcfffa;
    margin:0px auto;
    margin-top:50px;
    border-collapse: collapse;
}
#cart td,#cart th{
    min-height:40px;
    line-height:40px;
    border-top:1px solid #f1f1f1;
    border-bottom:1px solid #f1f1f1;
    padding:5px;
    vertical-align: top;
    text-align: left;
}
#cart thead input{
    vertical-align: middle;
}
#cart tbody input[type='checkbox']{
    float:left;
    margin-right: 10px;
}
#cart tbody div{
    border:1px solid #f1f1f1;
    padding:5px;
    float:left;
    width:90px;
    height:80px;
    text-align: center;
}

#cart a
{
    text-decoration:none;
    color:#666;
}
#cart a:hover
{
    color:#E4393C;
}
#cart tbody td span{
    font-weight: bold;
}

#cart tbody td input[type='text']{
    border:1px solid #CACBCB;
    border-left:0;
    border-right:0;
    height:20px;
    width:40px;
    padding:0;
    text-align: center;
}
#cart tbody td button{
    border:1px solid #CACBCB;
    height:20px;
    width:20px;
    padding:0;
    background-color: #fff;
    box-sizing:content-box;
}
#cart_footer{
    position: fixed;
    width:100%;
    height:80px;
    bottom:0px;
    left:0px;
    background-color: #fff;
    box-shadow: 0 -1px 8px rgba(0,1,1,.08);
    z-inxe:10000;
}
#cart_footer>div{
    text-align: right;
    margin:10px auto;
    width:800px;
    height:52px;
    line-height: 52px;
}
#cart_footer>div>span{
    font-size: 16px;
    color: #e4393c;
    font-weight: 700;
}
#cart_footer>div>button{
    display: inline-block;
    width: 96px;
    height: 52px;
    overflow: hidden;
    background-color:#E54346;
    border:0;
    line-height: 52px;
    color: #fff;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    font-family: "microsoft yahei";
    margin-left:20px;
}

body{
    overflow-x: hidden;
}

/*transition过渡：某种样式属性（数值）在一段时间内缓慢变化*/
#cart tbody img{
    transition: transform 0.5s linear;
}

/*transform：转换（变形：放大、移动、旋转、skew）*/
#cart tbody img:hover{
    transform:scale(1.1);
    /*transform:rotate(45deg);*/
}

#cart:hover::before{
    transition: left 2s;
    left: 1360px;
}
#cart:before{
    /*border:1px solid red;*/
    content: "";
    position: absolute;
    width: 80px;
    height: 400px;
    top: 180px;
    left: -150px;
    overflow: hidden;
    background-image: linear-gradient(to right,rgba(255,255,255,0.2) 0,rgba(255,255,255,0.8) 50%,rgba(255,255,255,0.2) 100%);
    transform: skewX(-15deg);
}

body {
    font: 12px "microsoft yahei", Arial, Helvetica, sans-serif;
    color:#666;
    margin:0px;
    padding:0px;
}
ul,li,p,h1,h2,h3,h4,h5,h6,dl,dt,dd {
    margin:0px;
    padding:0px;
    border:none;
    list-style:none;
}
input {border:none;}
.lf   {float:left;}
.rt  {float:right;}
.clear  {clear:both;}

/*整体布局*/
#top_box,#top_main,#nav,#banner,#main,#foot_box,#footer {
    width:1211px;
    margin:0px auto;
}

/*页面顶部! */
#top {
    width:100%;
    height:30px;
    background:#F7F7F7;
    line-height:30px;
    border-bottom:1px solid #eee;
}
#top>p{
    margin-left:40px;
    color: #666666;
    font-size: 13px;
}
#top>ul{
    margin-left: 450px;
}
#top>ul>li{
    float: left;
    margin: 0 20px;
}

#top>ul>li:nth-child(4) img,#top>ul>li:nth-child(5) img{
    vertical-align: middle;
}
#top>ul>li:nth-child(4) img{
    transition: transform 0.25s;
}
#top>ul>li:nth-child(4):hover img{
    transform:rotate(180deg);
}
#top>ul>li:nth-child(5) img{
    transition: transform 0.25s;
}
#top>ul>li:nth-child(5):hover img{
    transform:rotate(180deg);
}
#top>ul>li:nth-child(5){
    position: relative;
}
#merchant_box{
    background: #F7F7F7;
    width: 80px;
    text-align: center;
    position: absolute;
    left:-15px;
    top: 30px;
    z-index: 1;
    display: none;
}
#top_main {
    height:60px;
    padding:15px 0;
}
#nav {
    height:40px;
}
#foot_box {
    height:173px;
}
#footer {
    height:180px;
}

/**************************V02***********************************/
a  {
    color:#666;
    text-decoration:none;
}
a:hover {
    text-decoration:underline;
    color:#ff0700;
}

/**************************V03***********************************/
/*搜索框*/
#search_box {
    width: 420px;
    margin: 15px 0px 0 330px;
    position:relative;
}
div.search {
    width:385px;
    height: 35px;
    margin-bottom: 5px;
    border: 3px solid #1F74CF;
    background-color:#1F74CF;
}
input.text {
    width: 290px;
    height: 25px;
    padding: 5px;
    background-color: #fff;
    line-height: 20px;
    color: #999;
    font-family: arial,"\5b8b\4f53";
    position: relative;
}

#suggest {
    border: 1px solid #aaa;
    width: 302px;
    background: #fff;
    position: absolute;
    z-index: 102;
    top:40px;
    left: 0px;
    display: none;
}
#suggest ul {
    list-style: none;
    margin: 0;
    padding: 0;
}
#suggest ul li {
    line-height: 2em;
    padding: 0 1em;
    cursor: pointer;
    background: #fff;
    border: 0px;
}
#suggest ul li:hover {
    background: #eee;
}

input.button {
    width: 75px;
    background: #1F74CF;
    font-size: 14px;
    font-weight: 700;
    color: #fff;
    height: 30px;
}


/*去购物车结算*/
#settle_up {
    width: 100px;
    height: 30px;
    line-height: 30px;
    margin-top: 20px;
    margin-left:10px;
    padding: 0 5px 0px 25px;

    background-repeat: no-repeat;
    border: 1px solid #EFEFEF;
    background-position: -115px -84px;
    background-color: #F7F7F7;
    text-align: center;
    cursor: pointer;
}
#settle_up:hover {
    background-color:#fff;
    background-position: -115px -114px;
    z-index:60;
    position:relative;
}
#settle_up b {
    border-style: solid;
    border-width: 5px;
    border-color: #CCC transparent transparent transparent;
    line-height: 27px;
    cursor: pointer;
    position:relative;
    top:10px;
    right:-5px;
}

/**************************V04***********************************/
/*页脚*/
#foot_box {
    height:173px;
    border-top:1px #DDD solid;
    border-bottom:1px #F1F1F1 solid;
    margin-top:12px;
    background: #FFF;
}
#foot_box p {
    display:inline-block;
    width:40px;
    height:40px;
    float:left;
    margin:5px 5px 0px 55px;

    background-repeat:no-repeat;
}
#foot_box ul {
    width:140px;
    float:left;
 }
 #foot_box ul li {
    line-height:22px;
 }
 #foot_box ul li b {
    font-weight:bold;
    line-height:30px;
 }
#foot_box a:hover {color:#ff0700;}
p.shopping_guide {background-position:0px -55px}
p.send_type {background-position: -50px -55px;}
p.pay_type {background-position:0px -102px;}
p.sale_service {background-position:-50px -102px;}
p.special_service {background-position:0px -149px;}

/**************************V05***********************************/
/*页脚*/
#footer {
    height:180px;
    text-align:center;
    font-size:12px;
    margin:22px auto;
}

.copyright {
    width:800px;
    margin:0px auto;
    margin-top:12px;
    line-height:20px;
}
.links a {
    margin:0px 10px;
}
.authentication {
    margin:12px auto;
    width:532px;
}
.authentication a {
    margin:10px 12px;
    float:left;
}
#footer a:hover {color:#ff0700;}


/**************************V06***********************************/
/*导航部分*/
nav {
    background: #1F74CF;
}
#category {
    width:190px;
    float:left;
    background: #15318A;
}

/*全部商品分类*/
#category>a{
    display: inline-block;
    height: 40px;
    padding-left    : 20px;
    line-height: 40px;
   color: #fff;
   font-size:17px;
   font-weight:bold;
   text-decoration:none;
}

/*其他导航项*/
#nav_items {
    float:left;
}
#nav_items li {
    float:left;
    width:100px;
    height:40px;
}
#nav_items li a {
    display:block;
    height:40px;
    width: 85px;
    text-align: center;
    color: #fff;
    font-weight: bold;
    font-size:16px;
    text-decoration: none;
    line-height:40px;
}
#nav_items li a:hover {
    background-color:#15318a;
}

/**************************V07***********************************/
/*分类数据*/
#cate_box {
    width: 183px;
    height: 302px;
    padding: 4px 3px 3px 0;
    background: #FAFAFA;
    border:2px solid #1F74CF;
    border-top-width: 0px;
    overflow: visible;
}
#cate_box>li {
    width:186px;
    height:40px;
    border-bottom: 1px solid #FFF;

}
#cate_box li h3 {
    margin:0px;
    padding:0px 0px 0px 23px;
    font-size:16px;
    width: 156px;
    height: 40px;
    line-height: 40px;
    font-weight: 400;
    position: relative;
}
#cate_box li:hover h3{
    border-top:1px solid #DDD;
    border-bottom:1px solid #DDD;
    background-color:#fff;
    z-index: 101;
}
#cate_box li:hover .sub_cate_box{
    display: block;
}


#cate_box h3>a {
    color:#333;
    text-decoration:none;
}

/*banner>弹出部分*/
#cate_box {
    position:relative;
}
#cate_box h3:hover {
    position:relative;
    z-index:80;
}
.sub_cate_box {
    position: absolute;
    left: 178px;
    top: 2px;
    width: 575px;
    border: 1px solid #DDD;
    background: #fff;
    overflow: visible;
    box-shadow: 0 0 10px #DDD;
    z-index:70;
    display:block;
    height:250px;
    padding:5px;
}
.sub_cate_items {
    float:left;
    height:350px;
}
.sub_cate_banner {
    width:200px;
    float:right;
    padding:10px;
}


/*二级分类*/
.sub_cate_items>div {
    clear:left;
    padding:0px;
    margin:0px 0px 10px 10px;
    width:100%;
    border-bottom:1px solid #EEE;
}
.sub_cate_items>div>a {
    display:block;
    float:left;
    width:60px;
    height:22px;
    line-height: 22px;
    text-align: right;
    padding: 3px 8px 0 0px;
    color: #1F74CF;
    text-decoration: underline;
    font-weight:700;
}
.sub_cate_items p {
    width:350px;
    line-height:22px;
    float:left;
    margin:0 0 0 0;
}
.sub_cate_items p a {
    height:22px;
    line-height: 22px;
    text-align: right;
    padding: 0px 8px 0 0px;
    display:inline-block;
    padding: 0 4px;
    margin: 4px 0;
    border-left: 1px solid #ccc;
    color:#666;
    text-decoration:none;
}
.sub_cate_items p a:hover {
    color:red;
    text-decoration:underline;
}

/*弹出分类中的banner部分*/
.sub_cate_banner>div {
    width:100%;
    margin-bottom:5px;
}
.sub_cate_banner h4 {
    padding: 3px 6px 0 0;
    font-weight: 700;
    color: #1F74CF;
}
.sub_cate_banner li {
    width: 194px;
    float:left;
    padding:3px 0px;
}
.sub_cate_banner li a {
    color:#666;
    text-decoration:none;
}
.sub_cate_banner li a:hover {
    text-decoration:underline;
}


/*登陆框样式*/
.modal {
    position: fixed;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background: rgba(0,0,0, .7);
    z-index: 999;
}
.modal-dialog {
    width: 370px;
    margin: 100px auto;
}
.modal-content {
    background: #fff;
    border: 1px solid #aaa;
    border-radius: 3px;
    box-shadow: 0 0 5px #aaa;
    padding: 16px 12px;
}
.modal-content h4 {
    font-size: 1.5em;
}
.modal-content .alert {
    margin: 15px 0;
    border: 1px solid #e4393c;
    background: #fee;
    color: #e4393c;
    font-weight: bold;
    padding: 6px;
    border-radius: 2px;
}
.modal-content input {
    box-sizing: border-box; /*总宽=width+margin*/
    width: 100%;
    margin: 6px 0;
    line-height: 2em;
    border: 1px solid #aaa;
    border-radius: 2px;
    padding: 2px 6px;

}
#cart{
    {#margin-left: 100px;#}
    text-align:center ;
    width: 1000px;
}
.goods{
    height: 150px;
}  #cart tbody div {
    border: 1px solid #f1f1f1;
    padding: 5px;
    float: left;
       height: 140px;
                width:140px ;

    text-align: center;
}
            #cart a {
    text-decoration: none;
    color: #666;
    display: block;
    margin-top: 60px;
}#cart tbody td span {
    font-weight: bold;
    display: block;
    margin-top: 55%;
}

        </style>
    </head>

    <body>
        <div id="header"></div>

        <div id="main">
             <form id="goods">
            <table id="cart">
                <thead>
                <tr>
                    <th>
                        商品
                    </th>
                    <th>商品名</th>
                    <th>单价（元）</th>
                    <th>数量</th>
                    <th>小计</th>
                    <th>操作</th>
                </tr>
                </thead>


                <tbody  class="goods_list">
                             



                </tbody>



     <input type="button" onClick="msgbox(1)" value="评价">


            </table>
                  </form>

        </div>





    </body>
      <div id='inputbox' class="box">
         <div  style="font-size: 30px">
             <span class="all" >*</span>服务评价：
            <span class="star" >★</span>
            <span class="star" >★</span>
            <a class="star" >★</a>
            <span class="star">★</span>
            <span class="star">★</span>
            <span id="txt"></span>
         </div>
         <div id="pinja" style="text-align: center;height: 20px;">
             <textarea id="ttt" style="margin-left:10px ;margin-right: 10px"></textarea>
         </div>
         <div style="margin-top: 250px">
             <a id="submit_pingjia">jn</a>
         <a class='x'  onclick="msgbox(0); return false;">关闭</a>
         </div>

     </div>
    <script>

        $(".remove").live('click',function () {
            var th= $(this);

    var submit_data = {};
    submit_data['order_id']=$(this).parent().parent().attr("id").toString();
    //alert(submit_data['order_id'])

    $.ajax({
            url:"/checked_orders",
            type:"post",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(submit_data),
            dataType: "json",
             success:function(data){ //后端返回的json数据（此处data为json对象）
                if(data.mess=='ok') {
                    //alert(ts.parent().html())
                   th.parent().replaceWith('<td> <a class="eva">评价</a> </td>')
                }
              else
                {
                    alert(data.mess)
                }

          },
            error:function(e){
                alert("错误！！");
            }
        });
});
        $(".delNum").live('click', function(){

            var th = $(this);
            var po =  parseInt($(this).parent().find("input").attr("value").toString());

            if(po>1)
            {


                var submit_data = {};
                submit_data['order_id']=$(this).parent().parent().attr("id").toString();
            submit_data['op'] = 'minus';

            $.ajax({

                    url:"/shoopping_cart",
                    type:"post",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(submit_data),
                    dataType: "json",
                     success:function(data){ //后端返回的json数据（此处data为json对象）
                        if(data.mess=='ok') {
                            var num =  parseInt(th.parent().find("input").attr("value").toString())-1;

                            th.parent().find("input").replaceWith('<input class="goods_num" type="text" value="'+num+'">');
                            //alert(th.parent().find("input").attr("value"));

                                      var s=  (parseInt(th.parent().find("input").attr("value").toString())* parseInt(th.parent().parent().find(".price").html().toString()));

                           th.parent().parent().find(".sum").replaceWith('<span class="sum">'+s+'</span>');
                           app();
                        }

                      else
                        {
                            alert(data.mess)
                        }

                  },
                    error:function(e){
                        alert("错误！！");
                    }
                });
            }





        });
        $(".addNum").live('click', function(){

             var th = $(this);
            var po =  parseInt($(this).parent().find("input").attr("value").toString());



            {


                var submit_data = {};
                submit_data['order_id']=$(this).parent().parent().attr("id").toString();
            submit_data['op'] = 'plus';

            $.ajax({

                    url:"/shoopping_cart",
                    type:"post",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(submit_data),
                    dataType: "json",
                     success:function(data){ //后端返回的json数据（此处data为json对象）
                        if(data.mess=='ok') {
                            var num =  parseInt(th.parent().find("input").attr("value").toString())+1;

                            th.parent().find("input").replaceWith('<input class="goods_num" type="text" value="'+num+'">');
                               var s=  (parseInt(th.parent().find("input").attr("value").toString())* parseInt(th.parent().parent().find(".price").html().toString()));

                           th.parent().parent().find(".sum").replaceWith('<span class="sum">'+s+'</span>');
                           app();

                        }

                      else
                        {
                            alert(data.mess)
                        }

                  },
                    error:function(e){
                        alert("错误！！");
                    }
                });
            }





        });
    </script>
    <script>

</script>
<script>
       $.ajax({
            url: "/pay",
            type: "post",
            contentType: "application/json; charset=utf-8",

            dataType: "json",
            success: function (data) { //后端返回的json数据（此处data为json对象）
              if (data.mess=='ok') {
                  for (var i = 0; i < data.data.length; i++) {
                      var rec = ""
                        if (data.data[i].received=="0") {
                            rec ='<a class="remove">'+ "确认收货"+'</a>'

                        }
                        else if (data.data[i].received=="1")
                        {
                            rec ='<a class="eva">'+ "评价"+'</a>'
                        }
                        else
                        {
                             rec ='<a class="change_pinjia">'+ "查看评价/更改评价"+'</a>'
                        }

                      var xiaoji = parseInt(data.data[i].goods_price)*parseInt(data.data[i].order_num) ;
                      var ss = ' <tr class="goods"  id="'+data.data[i].orders_id+'">\n' +
                          '                    <td>\n' +

                          '                        <div><img src="/'+data.data[i].main_pic_addr+'" alt=""/></div>\n' +
                          '                    </td>\n' +
                          '                    <td><a >'+data.data[i].goods_name+'</a></td>\n' +
                          '                    <td><a class="price">'+data.data[i].goods_price+'</a></td>\n' +
                          '                    <td>\n' +
                          '                       <a class="goods_num" type="text" id="'+data.data[i].order_num+
                          '">   '+data.data[i].order_num+'\n  </a>' +
                          '                    </td>\n' +
                          '                    <td><span class="sum">'+xiaoji+'</span></td>\n' +
                          '                    <td>'+rec+'</td>\n' +
                          '                </tr>';
                      $('.goods_list').append(ss);
                     //document.getElementsByClassName("goods_list").innerHTML+=ss;



                  }


              }
              else {
                alert(data.mess);
              }

            },
            error: function (e) {
                alert("错误！！");
            }
        });
</script>
<script>

     $('input[name="checkall"]').on("click",function(){
				if($(this).is(':checked')){
					$('input[name="ko"]').each(function(){
						$(this).prop("checked",true);
					});
				}else{
					$('input[name="ko"]').each(function(){
						$(this).prop("checked",false);
					});
				}
				app();
			});

$('.goods_list').on('click','input',function () {
	if($(this).is(':checked')){
var allCheckNum = $("input[name='ko']").length;
var checkedNum = $("input[name='ko']:checked").length;
if (allCheckNum == checkedNum) {
    $('input[name="checkall"]').prop("checked",true)
} else {

}

				}else{
					$('input[name="checkall"]').prop("checked",false)
				}
				app();

});










</script>
<script>
     $("#jis").on('click',function () {


         var data=[]
        var formArray =$("#goods").serializeArray();
        $.each(formArray,function(i,item){
            if(item.name!="checkall")
            {
                data.push( item.value)
            }
        });
        var submit_data ={}
        submit_data['data'] = data
        $.ajax({
            url:"/cal_sub",
            type:"post",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(submit_data),
            dataType: "json",
             success:function(data){ //后端返回的json数据（此处data为json对象）

                    window.location.href=data.mess;

          },
            error:function(e){
                alert("错误！！");
            }
        });

     })

    function app() {



        var  num=0.0;
        var formArray =$("#goods").serializeArray();
        $.each(formArray,function(i,item){
             if(item.name!="checkall")
            {
                 num +=parseFloat($("#"+item.value).find('.sum').html().toString());
            }



        });
        $("#zongjia").replaceWith('<span  id="zongjia">'+num+'</span>');


    }

</script>

<style type="text/css">
	#contain{
		width: 300px;
		height: 40px;
		border:1px solid #ccc;
	}
	#content{
		width: 220px;
		height: 30px;
		margin-top: 5px;
		line-height: 30px;
	}
	.all{
		color: red;
	}
	.star{
		color: #c3c0c0;
	}
	#txt{
		margin-left: 5px;
	}
    #inputbox{
        text-align: center; /*让div内部文字居中*/
    background-color: #fff;
    border-radius: 20px;
    width: 500px;
    height: 350px;
    margin: auto;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
        position: fixed
    }
	</style>

<style>
.box{
    width:50%; margin-top:10%; margin:auto; padding:28px;
    height:350px; border:1px #111 solid;
    display:none;            /* 默认对话框隐藏 */
}
.box.show{display:block;}
.box .x{ font-size:18px; text-align:right; display:block;}
.box input{width:80%; font-size:18px; margin-top:18px;}
 #ttt{
         height: 200px;
    width: 500px;
 }
</style>
<script>
    var ordre_id = ""
    var xingji = ""
        function msgbox(n){
        if(n==0)
        {
            clear_star();
            $('textarea[id="ttt"]').val("")
        }
            document.getElementById('inputbox').style.display=n?'block':'none';     /* 点击按钮打开/关闭 对话框 */
        }


     $(".eva").live('click',function () {

        msgbox(1);
         ordre_id = $(this).parent().parent().attr("id").toString();

    })
    	$(".star").on('click',function () {
        var cont=['很差','较差','还行','推荐','满意'];
	var ostar=document.getElementsByClassName('star');
	var txt=document.getElementById('txt');

	var isChose=false;  //定义一个变量，解决点击事件和移出事件的冲突

	for(var i=0;i<ostar.length;i++){
		// 鼠标悬浮事件
		/*ostar[i].onmouseover=function(){
			if(!isChose){
				this.clr=true; //自定义属性，控制星星是否被选中
				for(var j=0;j<ostar.length;j++){
					if(ostar[j].clr==true){
						if(j<2){
							dis(j);
						}
						else{
							org(j);
						}
					}
				}
			}
		}*/

		// 鼠标点击事件
		ostar[i].onclick=function(){
			this.clr=true;
			isChose=true;
			clear();
			for(var j=0;j<ostar.length;j++){
				if(ostar[j].clr==true){
					if(j<2){
						dis(j);
					}
					else{
						org(j);
					}
				}
			}
		}

		//鼠标移出事件

	}

	//变成橘色星星
	function org(s){
		for(var i=0;i<=s;i++){
			ostar[i].clr=false;
			ostar[i].style.color='orange';
			txt.innerHTML=cont[i];
			xingji=i
		}
		txt.style.color='orange';
	}
	//变成灰色星星
	function dis(s){
		for(var i=0;i<=s;i++){
			ostar[i].clr=false;
			ostar[i].style.color='gray';
			txt.innerHTML=cont[i];
			xingji=i
		}
		txt.style.color='gray';
	}
	//清除所有星星的颜色
	function clear(){
		for(k=0;k<ostar.length;k++)
		ostar[k].style.color='#c3c0c0';
	}
    })


    function clear_star() {
        var ostar=document.getElementsByClassName('star');
	var txt=document.getElementById('txt');
		for(k=0;k<ostar.length;k++)
		ostar[k].style.color='#c3c0c0';
	txt.innerHTML = ""

    }
     $(".change_pinjia").live('click',function () {
            ordre_id = ($(this).parent().parent().attr("id"));
            submit_data = {}
            submit_data['order_id']=$(this).parent().parent().attr("id").toString();

            $.ajax({
            url:"/pingjia",
            type:"post",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(submit_data),
            dataType: "json",
             success:function(data){ //后端返回的json数据（此处data为json对象）
                if(data.mess=='ok') {
                    //alert(ts.parent().html())
                   $('textarea[id="ttt"]').val(data.data)

                        int_to_star(parseInt(data.star_class)-1)

                   msgbox(1)
                }
              else
                {
                    alert(data.mess)
                }

          },
            error:function(e){
                alert("错误！！");
            }
        });
        })
        $("#submit_pingjia").live('click',function () {
        {
            var th = $(this)
      xingji += 1
      data = {}
      data["order_id"] = ordre_id
      data["xingji"] = xingji
              alert($('textarea[id="ttt"]').val())


      data["content"] = $('textarea[id="ttt"]').val().toString()

      $.ajax({

                    url:"/evaluate",
                    type:"post",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(data),
                    dataType: "json",
                     success:function(data){ //后端返回的json数据（此处data为json对象）
                    if(data.mess =="ok")
                    {
                        msgbox(0);
                         $('textarea[id="ttt"]').val("")
                        xingji=-1
                        clear_star()
                        $("#"+ordre_id).find(".eva").replaceWith('<a class="change_pinjia">查看评价/更改评价</a>')


                    }

                  },
                    error:function(e){
                        alert("错误！！");
                    }
                });
  }
    })
    function int_to_star(s) {

        var ostar=document.getElementsByClassName('star');
	var txt=document.getElementById('txt');
	var cont=['很差','较差','还行','推荐','满意'];




		for(var i=0;i<=s;i++){
			ostar[i].clr=false;
			ostar[i].style.color='orange';
			txt.innerHTML=cont[i];
			xingji=i
		}
		txt.style.color='orange';

    }
</script>

</html>
